/*! Brytescore JavaScript library v0.2.0
 *  Copyright 2015 Brytecore, LLC
 */
/*! Brytescore JavaScript library v0.2.0
 *  Copyright 2015 Brytecore, LLC
 */
!function(a,b){"use strict";function c(a,b,c,f){if(k=d("Post",w+"/"+a),null!==k){var g={event:b,eventDisplayName:c,hostName:location.hostname,apiKey:m,anonymousId:n,userId:o,pageViewId:q,sessionId:p,data:f||{}};k.onload=e,k.onerror=function(a){console.log("Error with request"),console.log(a),console.log(k.response)},k.send(JSON.stringify(g))}}function d(b,c){var d=new XMLHttpRequest;return"withCredentials"in d?(d.open(b,c,!0),d.setRequestHeader("Content-Type","application/json")):"undefined"!=typeof XDomainRequest?a.navigator.userAgent.match(/MSIE [6-9]/)?(c=c.replace(/^http(?:s)?\:/,a.location.protocol),d=new XDomainRequest,d.open(b,c)):(d=new XDomainRequest,d.open(b,c),d.setRequestHeader("Content-Type","application/json")):d=null,d}function e(){var a=k.responseText;if(a&&""!==a&&(a=JSON.parse(a),a&&a.hasOwnProperty("code")))switch(a.code.toLowerCase()){case"success":break;case"unauthorizederror":break;case"badrequesterror":console.error("The request was not properly formatted.")}}function f(){brytescore.killHeartbeat(),H("brytescore_session",null,new Date(1974,9,18)),p=b,E=!0,q=b}function g(){t.removeListener?(t.removeListener("mousemove",I),t.removeListener("click",I),t.removeListener("keyup",I),t.removeListener("scroll",I)):t.detachEvent&&(t.detachEvent("onmousemove",I),t.detachEvent("onkeyup",I),t.detachEvent("onclick",I),t.detachEvent("onscroll",I)),t=b}function h(){clearInterval(C),C=0,s=setTimeout(function(){f()},15e5),t=a,t.addEventListener?(t.addEventListener("mousemove",I),t.addEventListener("click",I),t.addEventListener("scroll",I),t.addEventListener("keyup",I)):t.attachEvent&&(t.attachEvent("onmousemove",I),t.attachEvent("onclick",I),t.attachEvent("onscroll",I),t.attachEvent("onkeyup",I))}function i(a,b){var c=document.createElement("script");c.src=a,c.async=!0,c.onreadystatechange=c.onload=function(){var a=c.readyState;b.done||a&&!/loaded|complete/.test(a)||(b.done=!0,b())},document.getElementsByTagName("head")[0].appendChild(c)}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){b===c?c=0:0>c&&(c+=this.length,0>c&&(c=0));for(var d=this.length;d>c;c++)if(c in this&&this[c]===a)return c;return-1});var j,k,l,m,n,o,p,q,r,s,t,u=brytescore.q,v=[],w="https://api.brytescore.com",x=31536e6,y="heartBeat",z="pageView",A=15e3,B=0,C=0,D="",E=!1,F=function(a){console.log("Brytescore error: "+a)},G=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1);if(-1!==e.indexOf(b))return e.substring(b.length,e.length)}return null},H=function(a,b,c){a=encodeURIComponent(a),b=encodeURIComponent(b),document.cookie=null!==c?a+"="+b+"; expires="+c+"; path=/":a+"="+b+"; path=/"};a.brytescore=function(){""===D&&(D=location.href);var b=location.href;b!==D&&(a.brytescore.killHeartbeat(),a.brytescore.pageview({}),D=b);var c,d=[].slice.call(arguments);if(0===d.length&&F("Invalid method name."),j=d.shift(),0<j.indexOf(".")){var e=j.split("."),f=e[0],g=e[1];c="object"==typeof a.brytescore[f]?a.brytescore[f][g]:null}else c=a.brytescore[j];"function"==typeof c?c.apply(a,d):brytescore.q.push([].slice.call(arguments))},a.brytescore.q=[],a.brytescore.on=function(a,b){v.push(a,b)},a.brytescore.emit=function(){},a.brytescore.removeListener=function(a,b){for(var c=v,d=0;d<c.length;d++)a===c[d][0]&&b===c[d][1]&&v.splice(d,1)},a.brytescore.removeAllListeners=function(a){for(var b=v,c=0;c<b.length;c++)a===b[c][0]&&v.splice(c,1)},a.brytescore.authenticate=function(a,b){var c,d,e,f=G("brytescore_uu");o=a,null!==f?(c=JSON.parse(decodeURIComponent(f)),n=c.aid):n=brytescore.generateUUID(),d=JSON.stringify({aid:n,uid:a}),e=new Date,e.setTime(e.getTime()+x),H("brytescore_uu",d,e.toUTCString()),brytescore.track("authenticate","Logged In",b)},a.brytescore.submittedForm=function(a){brytescore.track("submittedForm","Submitted a Form",a)},a.brytescore.updateUserInfo=function(a,c){if(b===o||a!==o){var d,e,f,g=G("brytescore_uu");o=a,null!==g?(d=JSON.parse(decodeURIComponent(g)),n=d.aid):n=brytescore.generateUUID(),e=JSON.stringify({aid:n,uid:a}),f=new Date,f.setTime(f.getTime()+x),H("brytescore_uu",e,f.toUTCString())}brytescore.track("updateUserInfo","Updated User Information",c)},a.brytescore.registerAccount=function(a,c){if(b===o||a!==o){var d,e,f,g=G("brytescore_uu");o=a,null!==g?(d=JSON.parse(decodeURIComponent(g)),n=d.aid):n=brytescore.generateUUID(),e=JSON.stringify({aid:n,uid:a}),f=new Date,f.setTime(f.getTime()+x),H("brytescore_uu",e,f.toUTCString())}brytescore.track("registerAccount","Created a new account",c)},a.brytescore.setAPIKey=function(a){m=a},a.brytescore.pageview=function(b){B=0,q=brytescore.generateUUID(),b.pageUrl=a.location.href,b.pageTitle=document.title,b.referrer=document.referrer,brytescore.track(z,"Viewed a Page",b);var c=navigator.userAgent;b=JSON.stringify({sid:p,brw:c,aid:n});var d=new Date;d.setTime(d.getTime()+18e5),H("brytescore_session",b,d.toUTCString()),brytescore.heartBeat(),r=a.setInterval(function(){brytescore.heartBeat()},A)},a.brytescore.killHeartbeat=function(){clearInterval(r)},a.brytescore.track=function(a,b,d){c("track",a,b,d)},a.brytescore.heartBeat=function(){a.brytescore.track(y,"Heartbeat",{elapsedTime:B}),B+=A/1e3},a.brytescore.load=function(b){var c=d("GET",b);c.onload=function(){var b=c.readyState;if(!b||/loaded|complete/.test(b)||4===c.readyState&&200===c.status){{var d=JSON.parse(c.responseText),e=d.events,f=d.namespace;d.globals}a.brytescore[f]={};for(var g in e){a.brytescore.factory=function(b,c,d){return function(){return a.brytescore.track(c+"."+b,d,arguments[0])}},a.brytescore[f][g]=a.brytescore.factory(g,f,e[g].displayName);for(var h=0;h<a.brytescore.q.length;h++)f+"."+g===a.brytescore.q[h][0]&&a.brytescore[f][g](a.brytescore.q[h][1])}}},c.send(),a.brytescore.q=[]};var I=function(){0===C&&(b!==t&&g(),!0===E&&(a.brytescore.updateCookies(),a.brytescore.pageview({})),clearInterval(C),clearTimeout(s),C=a.setInterval(function(){h()},3e5))},J=[];for(l=0;256>l;l++)J[l]=(16>l?"0":"")+l.toString(16);a.brytescore.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return J[255&a]+J[a>>8&255]+J[a>>16&255]+J[a>>24&255]+"-"+J[255&b]+J[b>>8&255]+"-"+J[b>>16&15|64]+J[b>>24&255]+"-"+J[63&c|128]+J[c>>8&255]+"-"+J[c>>16&255]+J[c>>24&255]+J[255&d]+J[d>>8&255]+J[d>>16&255]+J[d>>24&255]},a.brytescore.updateCookies=function(){var a,b,c,d,e=G("brytescore_uu"),f=G("brytescore_session");null!==e?(a=JSON.parse(decodeURIComponent(e)),n=a.aid,o=a.uid):(n=brytescore.generateUUID(),o=""),b=JSON.stringify({aid:n,uid:o}),c=new Date,c.setTime(c.getTime()+x),H("brytescore_uu",b,c.toUTCString()),null!==f&&!0!==E?(a=JSON.parse(decodeURIComponent(f)),p=a.sid):(p=brytescore.generateUUID(),d=navigator.userAgent,b=JSON.stringify({sid:p,brw:d,aid:n}),c=new Date,c.setTime(c.getTime()+18e5),H("brytescore_session",b,c.toUTCString()),null===e&&brytescore.track("brytescore_uuid_created","New user id Created",{anonymousId:n}),(null===f||!0===E)&&(E=!1,brytescore.track("session_start","started new session",{sessionId:p,browserString:d,anonymousId:n})))},a.brytescore.is_loaded=function(a){console.log("is_loaded function called for package "+a)},a.brytescore.processQueue=function(){for(l=0;l<u.length;l++)brytescore.apply(document,u[l])},a.brytescore.init=function(){if("undefined"==typeof m)for(l=0;l<u.length;l++)"setapikey"===u[l][0].toLowerCase()&&(brytescore.setAPIKey(u[l][1]),u.splice(l,1));brytescore.updateCookies(),brytescore.processQueue(),I()},"object"!=typeof JSON?i("http://cdn.brytecore.net/brytescore.js/JSON3.min.js",function(){brytescore.init()}):brytescore.init()}(window);