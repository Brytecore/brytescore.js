/*! Brytescore JavaScript library v0.2.0
 *  Copyright 2015 Brytecore, LLC
 */
!function(a,b){"use strict";function c(a,b,c,f){if(l=d("Post",x+"/"+a),null!==l){var g={event:b,eventDisplayName:c,hostName:location.hostname,apiKey:n,anonymousId:o,userId:p,pageViewId:r,sessionId:q,data:f||{}};l.onload=e,l.onerror=function(a){console.log("Error with request"),console.log(a),console.log(l.response)},l.send(JSON.stringify(g))}}function d(b,c){var d=new XMLHttpRequest;return"withCredentials"in d?(d.open(b,c,!0),d.setRequestHeader("Content-Type","application/json")):"undefined"!=typeof XDomainRequest?a.navigator.userAgent.match(/MSIE [6-9]/)?(c=c.replace(/^http(?:s)?\:/,a.location.protocol),d=new XDomainRequest,d.open(b,c)):(d=new XDomainRequest,d.open(b,c),d.setRequestHeader("Content-Type","application/json")):d=null,d}function e(){var a=l.responseText;if(a&&""!==a&&(a=JSON.parse(a),a&&a.hasOwnProperty("code")))switch(a.code.toLowerCase()){case"success":break;case"unauthorizederror":break;case"badrequesterror":console.error("The request was not properly formatted.")}}function f(){g(),p=userID,o=brytescore.generateUUID(),q=brytescore.generateUUID();var b=navigator.userAgent;F=!1;var c=JSON.stringify({aid:o,uid:userID}),d=new Date;d.setTime(d.getTime()+y),I("brytescore_uu",c,d.toUTCString()),brytescore.track("session_start","started new session",{sessionId:q,browserString:b,anonymousId:o}),a.brytescore.pageview({})}function g(){brytescore.killHeartbeat(),I("brytescore_session",null,new Date(1974,9,18)),q=b,F=!0,r=b}function h(){u.removeListener?(u.removeListener("mousemove",J),u.removeListener("click",J),u.removeListener("keyup",J),u.removeListener("scroll",J)):u.detachEvent&&(u.detachEvent("onmousemove",J),u.detachEvent("onkeyup",J),u.detachEvent("onclick",J),u.detachEvent("onscroll",J)),u=b}function i(){clearInterval(D),D=0,t=setTimeout(function(){g()},15e5),u=a,u.addEventListener?(u.addEventListener("mousemove",J),u.addEventListener("click",J),u.addEventListener("scroll",J),u.addEventListener("keyup",J)):u.attachEvent&&(u.attachEvent("onmousemove",J),u.attachEvent("onclick",J),u.attachEvent("onscroll",J),u.attachEvent("onkeyup",J))}function j(a,b){var c=document.createElement("script");c.src=a,c.async=!0,c.onreadystatechange=c.onload=function(){var a=c.readyState;b.done||a&&!/loaded|complete/.test(a)||(b.done=!0,b())},document.getElementsByTagName("head")[0].appendChild(c)}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){b===c?c=0:0>c&&(c+=this.length,0>c&&(c=0));for(var d=this.length;d>c;c++)if(c in this&&this[c]===a)return c;return-1});var k,l,m,n,o,p,q,r,s,t,u,v=brytescore.q,w=[],x="https://api.brytescore.com",y=31536e6,z="heartBeat",A="pageView",B=15e3,C=0,D=0,E="",F=!1,G=function(a){console.log("Brytescore error: "+a)},H=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1);if(-1!==e.indexOf(b))return e.substring(b.length,e.length)}return null},I=function(a,b,c){a=encodeURIComponent(a),b=encodeURIComponent(b),document.cookie=null!==c?a+"="+b+"; expires="+c+"; path=/":a+"="+b+"; path=/"};a.brytescore=function(){""===E&&(E=location.href);var b=location.href;b!==E&&(a.brytescore.killHeartbeat(),a.brytescore.pageview({}),E=b);var c,d=[].slice.call(arguments);if(0===d.length&&G("Invalid method name."),k=d.shift(),0<k.indexOf(".")){var e=k.split("."),f=e[0],g=e[1];c="object"==typeof a.brytescore[f]?a.brytescore[f][g]:null}else c=a.brytescore[k];"function"==typeof c?c.apply(a,d):brytescore.q.push([].slice.call(arguments))},a.brytescore.q=[],a.brytescore.on=function(a,b){w.push(a,b)},a.brytescore.emit=function(){},a.brytescore.removeListener=function(a,b){for(var c=w,d=0;d<c.length;d++)a===c[d][0]&&b===c[d][1]&&w.splice(d,1)},a.brytescore.removeAllListeners=function(a){for(var b=w,c=0;c<b.length;c++)a===b[c][0]&&w.splice(c,1)},a.brytescore.authenticate=function(a,b){var c,d,e,g=H("brytescore_uu");null!==g?(c=JSON.parse(decodeURIComponent(g)),""!=c.uid&&c.uid!=a?f():o=c.aid):o=brytescore.generateUUID(),d=JSON.stringify({aid:o,uid:a}),e=new Date,e.setTime(e.getTime()+y),I("brytescore_uu",d,e.toUTCString()),brytescore.track("authenticate","Logged In",b)},a.brytescore.submittedForm=function(a){brytescore.track("submittedForm","Submitted a Form",a)},a.brytescore.updateUserInfo=function(a,c){if(b===p||a!==p){var d,e,f,g=H("brytescore_uu");p=a,null!==g?(d=JSON.parse(decodeURIComponent(g)),o=d.aid):o=brytescore.generateUUID(),e=JSON.stringify({aid:o,uid:a}),f=new Date,f.setTime(f.getTime()+y),I("brytescore_uu",e,f.toUTCString())}brytescore.track("updateUserInfo","Updated User Information",c)},a.brytescore.registerAccount=function(a,c){if(b===p||a!==p){var d,e,f,g=H("brytescore_uu");p=a,null!==g?(d=JSON.parse(decodeURIComponent(g)),o=d.aid):o=brytescore.generateUUID(),e=JSON.stringify({aid:o,uid:a}),f=new Date,f.setTime(f.getTime()+y),I("brytescore_uu",e,f.toUTCString())}brytescore.track("registerAccount","Created a new account",c)},a.brytescore.setAPIKey=function(a){n=a},a.brytescore.pageview=function(b){C=0,r=brytescore.generateUUID(),b.pageUrl=a.location.href,b.pageTitle=document.title,b.referrer=document.referrer,brytescore.track(A,"Viewed a Page",b);var c=navigator.userAgent;b=JSON.stringify({sid:q,brw:c,aid:o});var d=new Date;d.setTime(d.getTime()+18e5),I("brytescore_session",b,d.toUTCString()),brytescore.heartBeat(),s=a.setInterval(function(){brytescore.heartBeat()},B)},a.brytescore.killHeartbeat=function(){clearInterval(s)},a.brytescore.track=function(a,b,d){c("track",a,b,d)},a.brytescore.heartBeat=function(){a.brytescore.track(z,"Heartbeat",{elapsedTime:C}),C+=B/1e3},a.brytescore.load=function(b){var c=d("GET",b);c.onload=function(){var b=c.readyState;if(!b||/loaded|complete/.test(b)||4===c.readyState&&200===c.status){{var d=JSON.parse(c.responseText),e=d.events,f=d.namespace;d.globals}a.brytescore[f]={};for(var g in e){a.brytescore.factory=function(b,c,d){return function(){return a.brytescore.track(c+"."+b,d,arguments[0])}},a.brytescore[f][g]=a.brytescore.factory(g,f,e[g].displayName);for(var h=0;h<a.brytescore.q.length;h++)f+"."+g===a.brytescore.q[h][0]&&a.brytescore[f][g](a.brytescore.q[h][1])}}},c.send(),a.brytescore.q=[]};var J=function(){0===D&&(b!==u&&h(),!0===F&&(a.brytescore.updateCookies(),a.brytescore.pageview({})),clearInterval(D),clearTimeout(t),D=a.setInterval(function(){i()},3e5))},K=[];for(m=0;256>m;m++)K[m]=(16>m?"0":"")+m.toString(16);a.brytescore.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return K[255&a]+K[a>>8&255]+K[a>>16&255]+K[a>>24&255]+"-"+K[255&b]+K[b>>8&255]+"-"+K[b>>16&15|64]+K[b>>24&255]+"-"+K[63&c|128]+K[c>>8&255]+"-"+K[c>>16&255]+K[c>>24&255]+K[255&d]+K[d>>8&255]+K[d>>16&255]+K[d>>24&255]},a.brytescore.updateCookies=function(){var a,b,c,d,e=H("brytescore_uu"),f=H("brytescore_session");null!==e?(a=JSON.parse(decodeURIComponent(e)),o=a.aid,p=a.uid):(o=brytescore.generateUUID(),p=""),b=JSON.stringify({aid:o,uid:p}),c=new Date,c.setTime(c.getTime()+y),I("brytescore_uu",b,c.toUTCString()),null!==f&&!0!==F?(a=JSON.parse(decodeURIComponent(f)),q=a.sid):(q=brytescore.generateUUID(),d=navigator.userAgent,b=JSON.stringify({sid:q,brw:d,aid:o}),c=new Date,c.setTime(c.getTime()+18e5),I("brytescore_session",b,c.toUTCString()),null===e&&brytescore.track("brytescore_uuid_created","New user id Created",{anonymousId:o}),(null===f||!0===F)&&(F=!1,brytescore.track("session_start","started new session",{sessionId:q,browserString:d,anonymousId:o})))},a.brytescore.is_loaded=function(a){console.log("is_loaded function called for package "+a)},a.brytescore.processQueue=function(){for(m=0;m<v.length;m++)brytescore.apply(document,v[m])},a.brytescore.init=function(){if("undefined"==typeof n)for(m=0;m<v.length;m++)"setapikey"===v[m][0].toLowerCase()&&(brytescore.setAPIKey(v[m][1]),v.splice(m,1));brytescore.updateCookies(),brytescore.processQueue(),J()},"object"!=typeof JSON?j("http://cdn.brytecore.net/brytescore.js/JSON3.min.js",function(){brytescore.init()}):brytescore.init()}(window);