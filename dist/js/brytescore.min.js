/*! Brytescore JavaScript library v0.2.0
 *  Copyright 2015 Brytecore, LLC
 */
!function(a,b){"use strict";function c(a,b,c,f){if(j=d("Post",v+"/"+a),null!==j){var g={event:b,eventDisplayName:c,hostName:location.hostname,apiKey:l,anonymousId:m,userId:n,pageViewId:p,sessionId:o,data:f||{}};j.onload=e,j.onerror=function(a){console.log("Error with request"),console.log(a),console.log(j.response)},j.send(JSON.stringify(g))}}function d(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c.setRequestHeader("Content-Type","application/json"),c}function e(){var a=j.responseText;if(a&&""!==a&&(a=JSON.parse(a),a&&a.hasOwnProperty("code")))switch(a.code.toLowerCase()){case"success":break;case"unauthorizederror":break;case"badrequesterror":console.error("The request was not properly formatted.")}}function f(){brytescore.killHeartbeat(),G("brytescore_session",null,new Date(1974,9,18)),o=b,D=!0,p=b}function g(){s.removeListener?(s.removeListener("mousemove",H),s.removeListener("click",H),s.removeListener("keyup",H),s.removeListener("scroll",H)):s.detachEvent&&(s.detachEvent("onmousemove",H),s.detachEvent("onkeyup",H),s.detachEvent("onclick",H),s.detachEvent("onscroll",H)),s=b}function h(){clearInterval(B),B=0,r=setTimeout(function(){f()},15e5),s=a,s.addEventListener?(s.addEventListener("mousemove",H),s.addEventListener("click",H),s.addEventListener("scroll",H),s.addEventListener("keyup",H)):s.attachEvent&&(s.attachEvent("onmousemove",H),s.attachEvent("onclick",H),s.attachEvent("onscroll",H),s.attachEvent("onkeyup",H))}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){b===c?c=0:0>c&&(c+=this.length,0>c&&(c=0));for(var d=this.length;d>c;c++)if(c in this&&this[c]===a)return c;return-1});var i,j,k,l,m,n,o,p,q,r,s,t=brytescore.q,u=[],v="https://api.brytescore.com",w=31536e6,x="heartBeat",y="pageView",z=15e3,A=0,B=0,C="",D=!1,E=function(a){console.log("Brytescore error: "+a)},F=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1);if(-1!==e.indexOf(b))return e.substring(b.length,e.length)}return null},G=function(a,b,c){a=encodeURIComponent(a),b=encodeURIComponent(b),document.cookie=null!==c?a+"="+b+"; expires="+c+"; path=/":a+"="+b+"; path=/"};a.brytescore=function(){""===C&&(C=location.href);var b=location.href;b!==C&&(a.brytescore.killHeartbeat(),a.brytescore.pageview({}),C=b);var c,d=[].slice.call(arguments);if(0===d.length&&E("Invalid method name."),i=d.shift(),0<i.indexOf(".")){var e=i.split("."),f=e[0],g=e[1];c="object"==typeof a.brytescore[f]?a.brytescore[f][g]:null}else c=a.brytescore[i];"function"==typeof c?c.apply(a,d):brytescore.q.push([].slice.call(arguments))},a.brytescore.q=[],a.brytescore.on=function(a,b){u.push(a,b)},a.brytescore.emit=function(){},a.brytescore.removeListener=function(a,b){for(var c=u,d=0;d<c.length;d++)a===c[d][0]&&b===c[d][1]&&u.splice(d,1)},a.brytescore.removeAllListeners=function(a){for(var b=u,c=0;c<b.length;c++)a===b[c][0]&&u.splice(c,1)},a.brytescore.authenticate=function(a,b){var c,d,e,f=F("brytescore_uu");n=a,null!==f?(c=JSON.parse(decodeURIComponent(f)),m=c.aid):m=brytescore.generateUUID(),d=JSON.stringify({aid:m,uid:a}),e=new Date,e.setTime(e.getTime()+w),G("brytescore_uu",d,e.toUTCString()),brytescore.track("authenticate","Logged In",b)},a.brytescore.submittedForm=function(a){brytescore.track("submittedForm","Submitted a Form",a)},a.brytescore.updateUserInfo=function(a,c){if(b===n||a!==n){var d,e,f,g=F("brytescore_uu");n=a,null!==g?(d=JSON.parse(decodeURIComponent(g)),m=d.aid):m=brytescore.generateUUID(),e=JSON.stringify({aid:m,uid:a}),f=new Date,f.setTime(f.getTime()+w),G("brytescore_uu",e,f.toUTCString())}brytescore.track("updateUserInfo","Updated User Information",c)},a.brytescore.registerAccount=function(a,c){if(b===n||a!==n){var d,e,f,g=F("brytescore_uu");n=a,null!==g?(d=JSON.parse(decodeURIComponent(g)),m=d.aid):m=brytescore.generateUUID(),e=JSON.stringify({aid:m,uid:a}),f=new Date,f.setTime(f.getTime()+w),G("brytescore_uu",e,f.toUTCString())}brytescore.track("registerAccount","Created a new account",c)},a.brytescore.setAPIKey=function(a){l=a},a.brytescore.pageview=function(b){A=0;var c=a.location.protocol+"//"+a.location.host+"/"+a.location.pathname;p=brytescore.generateUUID(),b.pageUrl=c,b.pageTitle=document.title,b.referrer=document.referrer,brytescore.track(y,"Viewed a Page",b);var d=navigator.userAgent;b=JSON.stringify({sid:o,brw:d,aid:m});var e=new Date;e.setTime(e.getTime()+18e5),G("brytescore_session",b,e.toUTCString()),brytescore.heartBeat(),q=a.setInterval(function(){brytescore.heartBeat()},z)},a.brytescore.killHeartbeat=function(){clearInterval(q)},a.brytescore.track=function(a,b,d){c("track",a,b,d)},a.brytescore.heartBeat=function(){a.brytescore.track(x,"Heartbeat",{elapsedTime:A}),A+=z/1e3},a.brytescore.load=function(b){var c=d("GET",b);c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){{var b=JSON.parse(c.responseText),d=b.events,e=b.namespace;b.globals}a.brytescore[e]={};for(var f in d){a.brytescore.factory=function(b,c,d){return function(){return a.brytescore.track(c+"."+b,d,arguments[0])}},a.brytescore[e][f]=a.brytescore.factory(f,e,d[f].displayName);for(var g=0;g<a.brytescore.q.length;g++)e+"."+f===a.brytescore.q[g][0]&&a.brytescore[e][f](a.brytescore.q[g][1])}}},c.send(),a.brytescore.q=[]};var H=function(){0===B&&(b!==s&&g(),!0===D&&(a.brytescore.updateCookies(),a.brytescore.pageview({})),clearInterval(B),clearTimeout(r),B=a.setInterval(function(){h()},3e5))},I=[];for(k=0;256>k;k++)I[k]=(16>k?"0":"")+k.toString(16);a.brytescore.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return I[255&a]+I[a>>8&255]+I[a>>16&255]+I[a>>24&255]+"-"+I[255&b]+I[b>>8&255]+"-"+I[b>>16&15|64]+I[b>>24&255]+"-"+I[63&c|128]+I[c>>8&255]+"-"+I[c>>16&255]+I[c>>24&255]+I[255&d]+I[d>>8&255]+I[d>>16&255]+I[d>>24&255]},a.brytescore.updateCookies=function(){var a,b,c,d,e=F("brytescore_uu"),f=F("brytescore_session");null!==e?(a=JSON.parse(decodeURIComponent(e)),m=a.aid,n=a.uid):(m=brytescore.generateUUID(),n=""),b=JSON.stringify({aid:m,uid:n}),c=new Date,c.setTime(c.getTime()+w),G("brytescore_uu",b,c.toUTCString()),null!==f&&!0!==D?(a=JSON.parse(decodeURIComponent(f)),o=a.sid):(o=brytescore.generateUUID(),d=navigator.userAgent,b=JSON.stringify({sid:o,brw:d,aid:m}),c=new Date,c.setTime(c.getTime()+18e5),G("brytescore_session",b,c.toUTCString()),null===e&&brytescore.track("brytescore_uuid_created","New user id Created",{anonymousId:m}),(null===f||!0===D)&&(D=!1,brytescore.track("session_start","started new session",{sessionId:o,browserString:d,anonymousId:m})))},a.brytescore.is_loaded=function(a){console.log("is_loaded function called for package "+a)},a.brytescore.processQueue=function(){for(k=0;k<t.length;k++)brytescore.apply(document,t[k])},a.brytescore.init=function(){if("undefined"==typeof l)for(k=0;k<t.length;k++)"setapikey"===t[k][0].toLowerCase()&&(brytescore.setAPIKey(t[k][1]),t.splice(k,1));brytescore.updateCookies(),brytescore.processQueue(),H()},brytescore.init()}(window);