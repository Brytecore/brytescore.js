/*! Brytescore JavaScript library v0.3.0
 *  Copyright 2015 Brytecore, LLC
 */
!function(a,b){"use strict";function c(a,b,c,f){if(l=d("Post",x+"/"+a),null!==l){var g={event:b,eventDisplayName:c,hostName:location.hostname,apiKey:n,anonymousId:o,userId:p,pageViewId:r,sessionId:q,library:H,libraryVersion:I,schemaVersion:J[b.substring(0,b.indexOf("."))],data:f||{}};l.onload=e,l.onerror=function(a){console.log("Error with request"),console.log(a),console.log(l.response)},l.send(JSON.stringify(g))}}function d(b,c){var d=new XMLHttpRequest;return"withCredentials"in d?(d.open(b,c,!0),d.setRequestHeader("Content-Type","application/json")):"undefined"!=typeof XDomainRequest?a.navigator.userAgent.match(/MSIE [6-9]/)?(c=c.replace(/^http(?:s)?\:/,a.location.protocol),d=new XDomainRequest,d.open(b,c)):(d=new XDomainRequest,d.open(b,c),d.setRequestHeader("Content-Type","application/json")):d=null,d}function e(){var a=l.responseText;if(a&&""!==a&&(a=JSON.parse(a),a&&a.hasOwnProperty("code")))switch(a.code.toLowerCase()){case"success":break;case"unauthorizederror":break;case"badrequesterror":console.error("The request was not properly formatted.")}}function f(){g(),p=userID,o=brytescore.generateUUID(),q=brytescore.generateUUID();var b=navigator.userAgent;G=!1;var c=JSON.stringify({aid:o,uid:userID}),d=new Date;d.setTime(d.getTime()+y),M("brytescore_uu",c,d.toUTCString()),brytescore.track("sessionStarted","started new session",{sessionId:q,browserUA:b,anonymousId:o}),a.brytescore.pageView({})}function g(){brytescore.killHeartbeat(),M("brytescore_session",null,new Date(1974,9,18)),q=b,G=!0,r=b}function h(){u.removeListener?(u.removeListener("mousemove",N),u.removeListener("click",N),u.removeListener("keyup",N),u.removeListener("scroll",N)):u.detachEvent&&(u.detachEvent("onmousemove",N),u.detachEvent("onkeyup",N),u.detachEvent("onclick",N),u.detachEvent("onscroll",N)),u=b}function i(){clearInterval(E),E=0,t=setTimeout(function(){g()},15e5),u=a,u.addEventListener?(u.addEventListener("mousemove",N),u.addEventListener("click",N),u.addEventListener("scroll",N),u.addEventListener("keyup",N)):u.attachEvent&&(u.attachEvent("onmousemove",N),u.attachEvent("onclick",N),u.attachEvent("onscroll",N),u.attachEvent("onkeyup",N))}function j(a,b){var c=document.createElement("script");c.src=a,c.async=!0,c.onreadystatechange=c.onload=function(){var a=c.readyState;b.done||a&&!/loaded|complete/.test(a)||(b.done=!0,b())},document.getElementsByTagName("head")[0].appendChild(c)}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){b===c?c=0:0>c&&(c+=this.length,0>c&&(c=0));for(var d=this.length;d>c;c++)if(c in this&&this[c]===a)return c;return-1});var k,l,m,n,o,p,q,r,s,t,u,v=brytescore.q,w=[],x="https://api.brytescore.com",y=31536e6,z="heartBeat",A="pageView",B=0,C=15e3,D=0,E=0,F="",G=!1,H="javascript",I="0.3.0",J={},K=function(a){console.log("Brytescore error: "+a)},L=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1);if(-1!==e.indexOf(b))return e.substring(b.length,e.length)}return null},M=function(a,b,c){a=encodeURIComponent(a),b=encodeURIComponent(b),document.cookie=null!==c?a+"="+b+"; expires="+c+"; path=/":a+"="+b+"; path=/"};a.brytescore=function(){""===F&&(F=location.href);var b=location.href;b!==F&&(a.brytescore.killHeartbeat(),a.brytescore.pageView({}),F=b);var c,d=[].slice.call(arguments);if(0===d.length&&K("Invalid method name."),k=d.shift(),0<k.indexOf(".")){var e=k.split("."),f=e[0],g=e[1];c="object"==typeof a.brytescore[f]?a.brytescore[f][g]:null}else c=a.brytescore[k];"function"==typeof c?c.apply(a,d):brytescore.q.push([].slice.call(arguments))},a.brytescore.q=[],a.brytescore.on=function(a,b){w.push(a,b)},a.brytescore.emit=function(){},a.brytescore.removeListener=function(a,b){for(var c=w,d=0;d<c.length;d++)a===c[d][0]&&b===c[d][1]&&w.splice(d,1)},a.brytescore.removeAllListeners=function(a){for(var b=w,c=0;c<b.length;c++)a===b[c][0]&&w.splice(c,1)},a.brytescore.authenticated=function(a){var b,c,d,e=a.userAccount.id,g=L("brytescore_uu");null!==g?(b=JSON.parse(decodeURIComponent(g)),""!==b.uid&&b.uid!=e?f():o=b.aid):o=brytescore.generateUUID(),c=JSON.stringify({aid:o,uid:e}),d=new Date,d.setTime(d.getTime()+y),M("brytescore_uu",c,d.toUTCString()),brytescore.track("authenticated","Logged In",a)},a.brytescore.submittedForm=function(a){brytescore.track("submittedForm","Submitted a Form",a)},a.brytescore.updatedUserInfo=function(a){var c=a.userAccount.id;if(b===p||c!==p){var d,e,f,g=L("brytescore_uu");p=c,null!==g?(d=JSON.parse(decodeURIComponent(g)),o=d.aid):o=brytescore.generateUUID(),e=JSON.stringify({aid:o,uid:c}),f=new Date,f.setTime(f.getTime()+y),M("brytescore_uu",e,f.toUTCString())}brytescore.track("updatedUserInfo","Updated User Information",a)},a.brytescore.registeredAccount=function(a){var c=a.userAccount.id;if(b===p||c!==p){var d,e,f,g=L("brytescore_uu");p=c,null!==g?(d=JSON.parse(decodeURIComponent(g)),o=d.aid):o=brytescore.generateUUID(),e=JSON.stringify({aid:o,uid:c}),f=new Date,f.setTime(f.getTime()+y),M("brytescore_uu",e,f.toUTCString())}brytescore.track("registeredAccount","Created a new account",a)},a.brytescore.setAPIKey=function(a){n=a},a.brytescore.pageView=function(b){D=0,r=brytescore.generateUUID(),b.pageUrl=a.location.href,b.pageTitle=document.title,b.referrer=document.referrer,brytescore.track(A,"Viewed a Page",b);var c=navigator.userAgent;b=JSON.stringify({sid:q,brw:c,aid:o});var d=new Date;d.setTime(d.getTime()+18e5),M("brytescore_session",b,d.toUTCString()),brytescore.heartBeat(),s=a.setInterval(function(){var b=(new Date).getTime();0===B||18e5>b-B?(B=(new Date).getTime(),brytescore.heartBeat()):(B=0,g(),a.brytescore.updateCookies(),a.brytescore.pageView({}))},C)},a.brytescore.killHeartbeat=function(){clearInterval(s)},a.brytescore.track=function(a,b,d){c("track",a,b,d)},a.brytescore.heartBeat=function(){a.brytescore.track(z,"Heartbeat",{elapsedTime:D}),D+=C/1e3},a.brytescore.load=function(b){var c=d("GET",b);c.onload=function(){var b=c.readyState;if(!b||/loaded|complete/.test(b)||4===c.readyState&&200===c.status){var d=JSON.parse(c.responseText),e=d.events,f=d.namespace,g=d.version;J[f]=g,a.brytescore[f]={};for(var h in e){a.brytescore.factory=function(b,c,d){return function(){return a.brytescore.track(c+"."+b,d,arguments[0])}},a.brytescore[f][h]=a.brytescore.factory(h,f,e[h].displayName);for(var i=0;i<a.brytescore.q.length;i++)f+"."+h===a.brytescore.q[i][0]&&a.brytescore[f][h](a.brytescore.q[i][1])}}},c.send(),a.brytescore.q=[]};var N=function(){0===E&&(b!==u&&h(),!0===G&&(a.brytescore.updateCookies(),a.brytescore.pageView({})),clearInterval(E),clearTimeout(t),E=a.setInterval(function(){i()},3e5))},O=[];for(m=0;256>m;m++)O[m]=(16>m?"0":"")+m.toString(16);a.brytescore.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return O[255&a]+O[a>>8&255]+O[a>>16&255]+O[a>>24&255]+"-"+O[255&b]+O[b>>8&255]+"-"+O[b>>16&15|64]+O[b>>24&255]+"-"+O[63&c|128]+O[c>>8&255]+"-"+O[c>>16&255]+O[c>>24&255]+O[255&d]+O[d>>8&255]+O[d>>16&255]+O[d>>24&255]},a.brytescore.updateCookies=function(){var a,b,c,d,e=L("brytescore_uu"),f=L("brytescore_session");null!==e?(a=JSON.parse(decodeURIComponent(e)),o=a.aid,p=a.uid):(o=brytescore.generateUUID(),p=""),b=JSON.stringify({aid:o,uid:p}),c=new Date,c.setTime(c.getTime()+y),M("brytescore_uu",b,c.toUTCString()),null!==f&&!0!==G?(a=JSON.parse(decodeURIComponent(f)),q=a.sid):(q=brytescore.generateUUID(),d=navigator.userAgent,b=JSON.stringify({sid:q,brw:d,aid:o}),c=new Date,c.setTime(c.getTime()+18e5),M("brytescore_session",b,c.toUTCString()),null===e&&brytescore.track("brytescoreUUIDCreated","New user id Created",{anonymousId:o}),(null===f||!0===G)&&(G=!1,brytescore.track("sessionStarted","started new session",{sessionId:q,browserUA:d,anonymousId:o})))},a.brytescore.is_loaded=function(a){console.log("is_loaded function called for package "+a)},a.brytescore.processQueue=function(){for(m=0;m<v.length;m++)brytescore.apply(document,v[m])},a.brytescore.init=function(){if("undefined"==typeof n)for(m=0;m<v.length;m++)"setapikey"===v[m][0].toLowerCase()&&(brytescore.setAPIKey(v[m][1]),v.splice(m,1));brytescore.updateCookies(),brytescore.processQueue(),N()},"object"!=typeof JSON?j("http://cdn.brytecore.net/brytescore.js/JSON3.min.js",function(){brytescore.init()}):brytescore.init()}(window);