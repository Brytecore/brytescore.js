/*! Brytescore JavaScript library v0.3.3
 *  Copyright 2015-2016 Brytecore, LLC
 */
!function(a,b){"use strict";function c(a,b,c,f){if(l=d("Post",x+"/"+a),null!==l){var g={event:b,eventDisplayName:c,hostName:location.hostname,apiKey:n,anonymousId:o,userId:p.toString(),pageViewId:r,sessionId:q,library:H,libraryVersion:I,schemaVersion:-1===b.indexOf(".")?J.analytics:J[b.substring(0,b.indexOf("."))],data:f||{}};L&&(g.validationOnly=L),l.onload=e,l.onerror=function(a){console.log("Error with request"),console.log(a),console.log(l.response)},K?console.log(JSON.stringify(g)):l.send(JSON.stringify(g))}}function d(b,c){var d=new XMLHttpRequest;return"withCredentials"in d?(d.open(b,c,!0),d.setRequestHeader("Content-Type","application/json")):"undefined"!=typeof XDomainRequest?a.navigator.userAgent.match(/MSIE [6-9]/)?(c=c.replace(/^http(?:s)?\:/,a.location.protocol),d=new XDomainRequest,d.open(b,c)):(d=new XDomainRequest,d.open(b,c),d.setRequestHeader("Content-Type","application/json")):d=null,d}function e(){var a=l.responseText;if(a&&""!==a&&(a=JSON.parse(a),a&&a.hasOwnProperty("code")))switch(a.code.toLowerCase()){case"success":break;case"unauthorizederror":break;case"badrequesterror":M("The request was not properly formatted.")}}function f(b){g(),p=b,o=brytescore.generateUUID(),q=brytescore.generateUUID();var c=navigator.userAgent;G=!1;var d=JSON.stringify({aid:o,uid:b}),e=new Date;e.setTime(e.getTime()+y),O("brytescore_uu",d,e.toUTCString()),brytescore.track("sessionStarted","started new session",{sessionId:q,browserUA:c,anonymousId:o}),a.brytescore.pageView({})}function g(){brytescore.killHeartbeat(),O("brytescore_session",null,new Date(1974,9,18)),q=b,G=!0,r=b}function h(){u.removeListener?(u.removeListener("mousemove",P),u.removeListener("click",P),u.removeListener("keyup",P),u.removeListener("scroll",P)):u.detachEvent&&(u.detachEvent("onmousemove",P),u.detachEvent("onkeyup",P),u.detachEvent("onclick",P),u.detachEvent("onscroll",P)),u=b}function i(){clearInterval(E),E=0,t=setTimeout(function(){g()},15e5),u=a,u.addEventListener?(u.addEventListener("mousemove",P),u.addEventListener("click",P),u.addEventListener("scroll",P),u.addEventListener("keyup",P)):u.attachEvent&&(u.attachEvent("onmousemove",P),u.attachEvent("onclick",P),u.attachEvent("onscroll",P),u.attachEvent("onkeyup",P))}function j(a,b){var c=document.createElement("script");c.src=a,c.async=!0,c.onreadystatechange=c.onload=function(){var a=c.readyState;b.done||a&&!/loaded|complete/.test(a)||(b.done=!0,b())},document.getElementsByTagName("head")[0].appendChild(c)}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){b===c?c=0:0>c&&(c+=this.length,0>c&&(c=0));for(var d=this.length;c<d;c++)if(c in this&&this[c]===a)return c;return-1});var k,l,m,n,o,p,q,r,s,t,u,v=brytescore.q,w=[],x="https://api.brytescore.com",y=31536e6,z="heartBeat",A="pageView",B=0,C=15e3,D=0,E=0,F="",G=!1,H="javascript",I="0.3.3",J={analytics:"0.3.1"},K=!1,L=!1,M=function(a){console.log("Brytescore error: "+a)},N=function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "===d.charAt(0);)d=d.substring(1);if(-1!==d.indexOf(a))return d.substring(a.length,d.length)}return null},O=function(a,b,c){a=encodeURIComponent(a),b=encodeURIComponent(b),null!==c?document.cookie=a+"="+b+"; expires="+c+"; path=/":document.cookie=a+"="+b+"; path=/"};a.brytescore=function(){""===F&&(F=location.href);var b=location.href;b!==F&&(a.brytescore.killHeartbeat(),a.brytescore.pageView({}),F=b);var c,d=[].slice.call(arguments);if(0===d.length&&M("Invalid method name."),k=d.shift(),0<k.indexOf(".")){var e=k.split("."),f=e[0],g=e[1];c="object"==typeof a.brytescore[f]?a.brytescore[f][g]:null}else c=a.brytescore[k];"function"==typeof c?c.apply(a,d):brytescore.q.push([].slice.call(arguments))},a.brytescore.q=[],a.brytescore.on=function(a,b){w.push(a,b)},a.brytescore.emit=function(a,b){},a.brytescore.removeListener=function(a,b){for(var c=w,d=0;d<c.length;d++)a===c[d][0]&&b===c[d][1]&&w.splice(d,1)},a.brytescore.removeAllListeners=function(a){for(var b=w,c=0;c<b.length;c++)a===b[c][0]&&w.splice(c,1)},a.brytescore.authenticated=function(a){var b,c,d,e=a.userAccount.id,g=N("brytescore_uu");null!==g?(b=JSON.parse(decodeURIComponent(g)),""!==b.uid&&b.uid!=e?f(e):o=b.aid):o=brytescore.generateUUID(),c=JSON.stringify({aid:o,uid:e}),d=new Date,d.setTime(d.getTime()+y),O("brytescore_uu",c,d.toUTCString()),brytescore.track("authenticated","Logged In",a)},a.brytescore.submittedForm=function(a){brytescore.track("submittedForm","Submitted a Form",a)},a.brytescore.startedChat=function(a){brytescore.track("startedChat","User Started a Live Chat",a)},a.brytescore.updatedUserInfo=function(a){var c=a.userAccount.id;if(b===p||c!==p){var d,e,f,g=N("brytescore_uu");p=c,null!==g?(d=JSON.parse(decodeURIComponent(g)),o=d.aid):o=brytescore.generateUUID(),e=JSON.stringify({aid:o,uid:c}),f=new Date,f.setTime(f.getTime()+y),O("brytescore_uu",e,f.toUTCString())}brytescore.track("updatedUserInfo","Updated User Information",a)},a.brytescore.registeredAccount=function(a){var c=a.userAccount.id;if(b===p||c!==p){var d,e,f,g=N("brytescore_uu");p=c,null!==g?(d=JSON.parse(decodeURIComponent(g)),o=d.aid):o=brytescore.generateUUID(),e=JSON.stringify({aid:o,uid:c}),f=new Date,f.setTime(f.getTime()+y),O("brytescore_uu",e,f.toUTCString())}brytescore.track("registeredAccount","Created a new account",a)},a.brytescore.setAPIKey=function(a){n=a},a.brytescore.devMode=function(a){K=a},a.brytescore.validationMode=function(a){L=a},a.brytescore.pageView=function(b){D=0,r=brytescore.generateUUID(),b.pageUrl=a.location.href,b.pageTitle=document.title,b.referrer=document.referrer,brytescore.track(A,"Viewed a Page",b);var c=navigator.userAgent;b=JSON.stringify({sid:q,brw:c,aid:o});var d=new Date;d.setTime(d.getTime()+18e5),O("brytescore_session",b,d.toUTCString()),brytescore.heartBeat(),s=a.setInterval(function(){var b=(new Date).getTime();0===B||18e5>b-B?(B=(new Date).getTime(),brytescore.heartBeat()):(B=0,g(),a.brytescore.updateCookies(),a.brytescore.pageView({}))},C)},a.brytescore.killHeartbeat=function(){clearInterval(s)},a.brytescore.track=function(a,b,d){c("track",a,b,d)},a.brytescore.heartBeat=function(){a.brytescore.track(z,"Heartbeat",{elapsedTime:D}),D+=C/1e3},a.brytescore.load=function(b){var c=d("GET",b);c.onload=function(){var b=c.readyState;if(!b||/loaded|complete/.test(b)||4===c.readyState&&200===c.status){var d=JSON.parse(c.responseText),e=d.events,f=d.namespace;J[f]=d.version,a.brytescore[f]={};for(var g in e){a.brytescore.factory=function(b,c,d){return function(){return a.brytescore.track(c+"."+b,d,arguments[0])}},a.brytescore[f][g]=a.brytescore.factory(g,f,e[g].displayName);for(var h=0;h<a.brytescore.q.length;h++)f+"."+g===a.brytescore.q[h][0]&&a.brytescore[f][g](a.brytescore.q[h][1])}}},c.send(),a.brytescore.q=[]};var P=function(){0===E&&(b!==u&&h(),!0===G&&(a.brytescore.updateCookies(),a.brytescore.pageView({})),clearInterval(E),clearTimeout(t),E=a.setInterval(function(){i()},3e5))},Q=[];for(m=0;256>m;m++)Q[m]=(16>m?"0":"")+m.toString(16);a.brytescore.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return Q[255&a]+Q[a>>8&255]+Q[a>>16&255]+Q[a>>24&255]+"-"+Q[255&b]+Q[b>>8&255]+"-"+Q[b>>16&15|64]+Q[b>>24&255]+"-"+Q[63&c|128]+Q[c>>8&255]+"-"+Q[c>>16&255]+Q[c>>24&255]+Q[255&d]+Q[d>>8&255]+Q[d>>16&255]+Q[d>>24&255]},a.brytescore.updateCookies=function(){var a,b,c,d,e=N("brytescore_uu"),f=N("brytescore_session");null!==e?(a=JSON.parse(decodeURIComponent(e)),o=a.aid,p=a.uid):(o=brytescore.generateUUID(),p=""),b=JSON.stringify({aid:o,uid:p}),c=new Date,c.setTime(c.getTime()+y),O("brytescore_uu",b,c.toUTCString()),null!==f&&!0!==G?(a=JSON.parse(decodeURIComponent(f)),q=a.sid):(q=brytescore.generateUUID(),d=navigator.userAgent,b=JSON.stringify({sid:q,brw:d,aid:o}),c=new Date,c.setTime(c.getTime()+18e5),O("brytescore_session",b,c.toUTCString()),null===e&&brytescore.track("brytescoreUUIDCreated","New user id Created",{anonymousId:o}),null!==f&&!0!==G||(G=!1,brytescore.track("sessionStarted","started new session",{sessionId:q,browserUA:d,anonymousId:o})))},a.brytescore.is_loaded=function(a){console.log("is_loaded function called for package "+a)},a.brytescore.processQueue=function(){for(m=0;m<v.length;m++)brytescore.apply(document,v[m])},a.brytescore.init=function(){if("undefined"==typeof n)for(m=0;m<v.length;m++)"setapikey"===v[m][0].toLowerCase()&&(brytescore.setAPIKey(v[m][1]),v.splice(m,1));brytescore.updateCookies(),brytescore.processQueue(),P()},"object"!=typeof JSON?j("http://cdn.brytecore.net/brytescore.js/JSON3.min.js",function(){brytescore.init()}):brytescore.init()}(window);