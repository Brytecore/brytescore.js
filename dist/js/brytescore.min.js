/*! Brytescore JavaScript library v0.3.4
 *  Copyright 2015-2017 Brytecore, Inc
 */
!function(a,b){"use strict";function c(a,b,c,f){if(null!==(k=d("Post",v+"/"+a))){var g=b.indexOf("."),h={event:b,eventDisplayName:c,hostName:location.hostname,apiKey:l,anonymousId:m,userId:n.toString(),pageViewId:p,sessionId:o,library:C,libraryVersion:D,schemaVersion:-1===g?E.analytics:E[b.substring(0,g)],data:f||{}};G&&(h.validationOnly=G),k.onload=e,k.onerror=function(a){console.log("Error with request"),console.log(a),console.log(k.response)},h=JSON.stringify(h),F?console.log(h):k.send(h)}}function d(b,c){var d=new XMLHttpRequest;return"withCredentials"in d?(d.open(b,c,!0),d.setRequestHeader("Content-Type","application/json")):"undefined"!=typeof XDomainRequest?a.navigator.userAgent.match(/MSIE [6-9]/)?(c=c.replace(/^http(?:s)?\:/,a.location.protocol),d=new XDomainRequest,d.open(b,c)):(d=new XDomainRequest,d.open(b,c),d.setRequestHeader("Content-Type","application/json")):d=null,d}function e(){var a=k.responseText;if(a&&""!==a&&(a=JSON.parse(a))&&a.hasOwnProperty("code"))switch(a.code.toLowerCase()){case"success":break;case"unauthorizederror":break;case"badrequesterror":H("The request was not properly formatted.")}}function f(b){g(),n=b,m=brytescore.generateUUID(),o=brytescore.generateUUID();var c=navigator.userAgent;B=!1;var d=JSON.stringify({aid:m,uid:b}),e=new Date;e.setTime(e.getTime()+w),J("brytescore_uu",d,e.toUTCString()),brytescore.track("sessionStarted","started new session",{sessionId:o,browserUA:c,anonymousId:m}),a.brytescore.pageView({})}function g(){brytescore.killHeartbeat(),J("brytescore_session",null,new Date(1974,9,18)),o=b,B=!0,p=b}function h(){s.removeListener?(s.removeListener("mousemove",K),s.removeListener("click",K),s.removeListener("keyup",K),s.removeListener("scroll",K)):s.detachEvent&&(s.detachEvent("onmousemove",K),s.detachEvent("onkeyup",K),s.detachEvent("onclick",K),s.detachEvent("onscroll",K)),s=b}function i(){clearInterval(z),z=0,r=setTimeout(function(){g()},15e5),s=a,s.addEventListener?(s.addEventListener("mousemove",K),s.addEventListener("click",K),s.addEventListener("scroll",K),s.addEventListener("keyup",K)):s.attachEvent&&(s.attachEvent("onmousemove",K),s.attachEvent("onclick",K),s.attachEvent("onscroll",K),s.attachEvent("onkeyup",K))}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){b===c?c=0:0>c&&0>(c+=this.length)&&(c=0);for(var d=this.length;c<d;c++)if(c in this&&this[c]===a)return c;return-1});var j,k,l,m,n,o,p,q,r,s,t=brytescore.q,u=[],v="https://api.brytescore.com",w=31536e6,x=0,y=0,z=0,A="",B=!1,C="javascript",D="0.3.4",E={analytics:"0.3.1"},F=!1,G=!1,H=function(a){console.log("Brytescore error: "+a)},I=function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "===d.charAt(0);)d=d.substring(1);if(-1!==d.indexOf(a))return d.substring(a.length,d.length)}return null},J=function(a,b,c){a=encodeURIComponent(a),b=encodeURIComponent(b),document.cookie=null!==c?a+"="+b+"; expires="+c+"; path=/":a+"="+b+"; path=/"};a.brytescore=function(){""===A&&(A=location.href);var b=location.href;b!==A&&(a.brytescore.killHeartbeat(),a.brytescore.pageView({}),A=b);var c,d=[].slice.call(arguments);if(0===d.length&&H("Invalid method name."),j=d.shift(),0<j.indexOf(".")){var e=j.split("."),f=e[0],g=e[1];c="object"==typeof a.brytescore[f]?a.brytescore[f][g]:null}else c=a.brytescore[j];"function"==typeof c?c.apply(a,d):brytescore.q.push([].slice.call(arguments))},a.brytescore.q=[],a.brytescore.on=function(a,b){u.push(a,b)},a.brytescore.emit=function(a,b){},a.brytescore.removeListener=function(a,b){for(var c=u,d=0;d<c.length;d++)a===c[d][0]&&b===c[d][1]&&u.splice(d,1)},a.brytescore.removeAllListeners=function(a){for(var b=u,c=0;c<b.length;c++)a===b[c][0]&&u.splice(c,1)},a.brytescore.authenticated=function(a){if(!a||!a.isImpersonating){var b,c,d,e=a.userAccount.id,g=I("brytescore_uu");null!==g?(b=JSON.parse(decodeURIComponent(g)),""!==b.uid&&b.uid!=e?f(e):m=b.aid):m=brytescore.generateUUID(),c=JSON.stringify({aid:m,uid:e}),d=new Date,d.setTime(d.getTime()+w),J("brytescore_uu",c,d.toUTCString()),brytescore.track("authenticated","Logged In",a)}},a.brytescore.submittedForm=function(a){a&&a.isImpersonating||brytescore.track("submittedForm","Submitted a Form",a)},a.brytescore.startedChat=function(a){a&&a.isImpersonating||brytescore.track("startedChat","User Started a Live Chat",a)},a.brytescore.updatedUserInfo=function(a){if(!a||!a.isImpersonating){var c=a.userAccount.id;if(b===n||c!==n){var d,e,f,g=I("brytescore_uu");n=c,null!==g?(d=JSON.parse(decodeURIComponent(g)),m=d.aid):m=brytescore.generateUUID(),e=JSON.stringify({aid:m,uid:c}),f=new Date,f.setTime(f.getTime()+w),J("brytescore_uu",e,f.toUTCString())}brytescore.track("updatedUserInfo","Updated User Information",a)}},a.brytescore.registeredAccount=function(a){if(!a||!a.isImpersonating){var c=a.userAccount.id;if(b===n||c!==n){var d,e,f,g=I("brytescore_uu");n=c,null!==g?(d=JSON.parse(decodeURIComponent(g)),m=d.aid):m=brytescore.generateUUID(),e=JSON.stringify({aid:m,uid:c}),f=new Date,f.setTime(f.getTime()+w),J("brytescore_uu",e,f.toUTCString())}brytescore.track("registeredAccount","Created a new account",a)}},a.brytescore.setAPIKey=function(a){l=a},a.brytescore.devMode=function(a){F=a},a.brytescore.validationMode=function(a){G=a},a.brytescore.pageView=function(b){if(!b||!b.isImpersonating){y=0,p=brytescore.generateUUID(),b.pageUrl=a.location.href,b.pageTitle=document.title,b.referrer=document.referrer,brytescore.track("pageView","Viewed a Page",b);var c=navigator.userAgent;b=JSON.stringify({sid:o,brw:c,aid:m});var d=new Date;d.setTime(d.getTime()+18e5),J("brytescore_session",b,d.toUTCString()),brytescore.heartBeat(),q=a.setInterval(function(){var b=(new Date).getTime();0===x||18e5>b-x?(x=(new Date).getTime(),brytescore.heartBeat()):(x=0,g(),a.brytescore.updateCookies(),a.brytescore.pageView({}))},15e3)}},a.brytescore.killHeartbeat=function(){clearInterval(q)},a.brytescore.track=function(a,b,d){d&&d.isImpersonating||c("track",a,b,d)},a.brytescore.heartBeat=function(){a.brytescore.track("heartBeat","Heartbeat",{elapsedTime:y}),y+=15},a.brytescore.load=function(b){var c=d("GET",b);c.onload=function(){var b=c.readyState;if(!b||/loaded|complete/.test(b)||4===c.readyState&&200===c.status){var d=JSON.parse(c.responseText),e=d.events,f=d.namespace;E[f]=d.version,a.brytescore[f]={};for(var g in e){a.brytescore.factory=function(b,c,d){return function(){return a.brytescore.track(c+"."+b,d,arguments[0])}},a.brytescore[f][g]=a.brytescore.factory(g,f,e[g].displayName);for(var h=0;h<a.brytescore.q.length;h++)f+"."+g===a.brytescore.q[h][0]&&a.brytescore[f][g](a.brytescore.q[h][1])}}},c.send(),a.brytescore.q=[]};for(var K=function(){0===z&&(b!==s&&h(),!0===B&&(a.brytescore.updateCookies(),a.brytescore.pageView({})),clearInterval(z),clearTimeout(r),z=a.setInterval(function(){i()},3e5))},L=[],M=0;256>M;M++)L[M]=(16>M?"0":"")+M.toString(16);a.brytescore.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return L[255&a]+L[a>>8&255]+L[a>>16&255]+L[a>>24&255]+"-"+L[255&b]+L[b>>8&255]+"-"+L[b>>16&15|64]+L[b>>24&255]+"-"+L[63&c|128]+L[c>>8&255]+"-"+L[c>>16&255]+L[c>>24&255]+L[255&d]+L[d>>8&255]+L[d>>16&255]+L[d>>24&255]},a.brytescore.updateCookies=function(){var a,b,c,d,e=I("brytescore_uu"),f=I("brytescore_session");null!==e?(a=JSON.parse(decodeURIComponent(e)),m=a.aid,n=a.uid):(m=brytescore.generateUUID(),n=""),b=JSON.stringify({aid:m,uid:n}),c=new Date,c.setTime(c.getTime()+w),J("brytescore_uu",b,c.toUTCString()),null!==f&&!0!==B?(a=JSON.parse(decodeURIComponent(f)),o=a.sid):(o=brytescore.generateUUID(),d=navigator.userAgent,b=JSON.stringify({sid:o,brw:d,aid:m}),c=new Date,c.setTime(c.getTime()+18e5),J("brytescore_session",b,c.toUTCString()),null===e&&brytescore.track("brytescoreUUIDCreated","New user id Created",{anonymousId:m}),null!==f&&!0!==B||(B=!1,brytescore.track("sessionStarted","started new session",{sessionId:o,browserUA:d,anonymousId:m})))},a.brytescore.is_loaded=function(a){console.log("is_loaded function called for package "+a)},a.brytescore.processQueue=function(){for(var a=0;a<t.length;a++)brytescore.apply(document,t[a])},a.brytescore.init=function(){if(void 0===l)for(var a=0;a<t.length;a++)"setapikey"===t[a][0].toLowerCase()&&(brytescore.setAPIKey(t[a][1]),t.splice(a,1));brytescore.updateCookies(),brytescore.processQueue(),K()},"object"!=typeof JSON?function(a,b){var c=document.createElement("script");c.src=a,c.async=!0,c.onreadystatechange=c.onload=function(){var a=c.readyState;b.done||a&&!/loaded|complete/.test(a)||(b.done=!0,b())},document.getElementsByTagName("head")[0].appendChild(c)}("http://cdn.brytecore.net/brytescore.js/JSON3.min.js",function(){brytescore.init()}):brytescore.init()}(window);